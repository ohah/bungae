# Bungae - Metro í˜¸í™˜ React Native ë²ˆë“¤ëŸ¬

Bun ê¸°ë°˜ React Native ë²ˆë“¤ëŸ¬ë¡œ, Metroì™€ í˜¸í™˜ë˜ë©´ì„œ ë” ë‚˜ì€ ì„±ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

## í•µì‹¬ ì›ì¹™

1. **Metro í˜¸í™˜ì„± ìš°ì„ **: ê¸°ì¡´ Metro í”„ë¡œì íŠ¸ê°€ ìµœì†Œí•œì˜ ë³€ê²½ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ëŠ¥
2. **ì„±ëŠ¥ ìµœìš°ì„ **: Bunì˜ ì„±ëŠ¥ ì´ì ì„ ìµœëŒ€í•œ í™œìš©í•˜ì—¬ ë¹Œë“œ ì†ë„ ê°œì„ 
3. **ì ì§„ì  ê°œì„ **: í•µì‹¬ ê¸°ëŠ¥ë¶€í„° êµ¬í˜„í•˜ê³  ì ì§„ì ìœ¼ë¡œ í™•ì¥
4. **Bun ë„¤ì´í‹°ë¸Œ ìš°ì„ **: ê°€ëŠ¥í•œ í•œ Bun ë‚´ì¥ API í™œìš©

## ë²ˆë“¤ë§ í”„ë¡œì„¸ìŠ¤

3ë‹¨ê³„ íŒŒì´í”„ë¼ì¸: `Entry â†’ [Resolution] â†’ [Transformation] â†’ [Serialization] â†’ Bundle`

### Resolution (ëª¨ë“ˆ í•´ì„)

- **ìì²´ ëª¨ë“ˆ í•´ì„**: `require.resolve()` ê¸°ë°˜ ëª¨ë“ˆ í•´ì„
- **Platform Resolver**: React Native í”Œë«í¼ í™•ì¥ì (`.ios.js`, `.android.js`, `.native.js`) ì²˜ë¦¬
- **êµ¬í˜„ ìœ„ì¹˜**: `graph-bundler.ts`ì˜ `resolveModule()` í•¨ìˆ˜

### Transformation (ì½”ë“œ ë³€í™˜)

**í˜„ì¬ êµ¬í˜„ (Phase 1+)**: Metroì™€ ë™ì¼í•˜ê²Œ **Babel + Hermes Parser** ì‚¬ìš©

```
Entry â†’ Hermes Parser (Flow íŒŒì‹±) â†’ @react-native/babel-preset (ëª¨ë“  ë³€í™˜) â†’ Output
```

| ë„êµ¬                       | ì—­í•                                            |
| -------------------------- | ---------------------------------------------- |
| Hermes Parser              | Flow êµ¬ë¬¸ íŒŒì‹± (Metroì™€ ë™ì¼)                  |
| @react-native/babel-preset | Flow ì œê±°, JSX ë³€í™˜, ESMâ†’CJS ë³€í™˜ (all-in-one) |

**êµ¬í˜„ ìœ„ì¹˜**: `graph-bundler.ts`ì˜ `transformWithBabel()` í•¨ìˆ˜

#### ë¯¸ì‚¬ìš© ì½”ë“œ (ì£¼ì„ ì²˜ë¦¬ë¨)

ë‹¤ìŒ íŒŒì¼ë“¤ì€ í˜„ì¬ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©°, í–¥í›„ ìµœì í™”ë¥¼ ìœ„í•´ ë³´ê´€:

- `bun-transformer.ts` - Bun.Transpiler ì‚¬ìš© (Flow ë¯¸ì§€ì›)
- `swc-transformer.ts` - SWC ì‚¬ìš© (Flow ë¯¸ì§€ì›)
- `bun-bundler.ts` - Bun.build() ì‚¬ìš© (Metro ëª¨ë“ˆ ì‹œìŠ¤í…œ ë¯¸ì§€ì›)

#### ì ì§„ì  ë„¤ì´í‹°ë¸Œ ì „í™˜ ê³„íš

**ì „ëµ**: Metroì™€ ë™ì¼í•˜ê²Œ ë™ì‘í•˜ë©´ì„œ ì ì§„ì ìœ¼ë¡œ Babel â†’ ë„¤ì´í‹°ë¸Œë¡œ êµì²´

```
Phase 1+ (í˜„ì¬): Babel + Hermes Parser (Metro ë™ì¼)
     â†“
Phase 2: Hermes Parser + SWC (Babel ì¼ë¶€ ì œê±°)
     â†“
Phase 3: Hermes Parser + Bun.Transpiler (Babel ìµœì†Œí™”)
     â†“
Phase 4: Bun ë„¤ì´í‹°ë¸Œ
```

**êµì²´ ëŒ€ìƒ (ìš°ì„ ìˆœìœ„ìˆœ)**:

1. **ESM â†’ CJS ë³€í™˜**: `@babel/plugin-transform-modules-commonjs` â†’ SWC
2. **JSX ë³€í™˜**: `@babel/preset-react` â†’ SWC ë˜ëŠ” Bun.Transpiler
3. **Flow íƒ€ì… ì œê±°**: `@babel/plugin-transform-flow-strip-types` â†’ Hermes Parser ì§ì ‘ ì¡°ì‘
4. **ê¸°íƒ€ ë³€í™˜**: ê°œë³„ Babel í”ŒëŸ¬ê·¸ì¸ â†’ SWC í”ŒëŸ¬ê·¸ì¸

**ê²€ì¦ ë°©ì‹**: Metro ë²¤ì¹˜ë§ˆí‚¹ í…ŒìŠ¤íŠ¸

- Metro ë²ˆë“¤ê³¼ Bungae ë²ˆë“¤ì„ ë™ì¼ ì…ë ¥ìœ¼ë¡œ ìƒì„±
- ë²ˆë“¤ ì¶œë ¥ ë¹„êµ (êµ¬ì¡°, ëª¨ë“ˆ ìˆœì„œ, ì½”ë“œ)
- ì„±ëŠ¥ ë¹„êµ (ë¹Œë“œ ì‹œê°„, ë²ˆë“¤ í¬ê¸°)
- React Native ì•±ì—ì„œ ì‹¤ì œ ë™ì‘ í…ŒìŠ¤íŠ¸

### Serialization (ë²ˆë“¤ ì§ë ¬í™”)

- Plain Bundle (ê¸°ë³¸)
- RAM Bundle (Indexed/File) - ë ˆê±°ì‹œ ìµœì í™”, Hermes ì‚¬ìš© ì‹œ ë¶ˆí•„ìš”

## Bun API í™œìš©

```typescript
// âœ… í˜„ì¬ ì‚¬ìš© ì¤‘
Bun.serve(); // HTTP ì„œë²„ + WebSocket (HMR)
Bun.file(); // íŒŒì¼ I/O

// ğŸ”„ í–¥í›„ ì‚¬ìš© ì˜ˆì • (ì ì§„ì  ì „í™˜)
Bun.Transpiler; // ì½”ë“œ ë³€í™˜ (í˜„ì¬ëŠ” Babel ì‚¬ìš©)
Bun.build(); // ë²ˆë“¤ë§ (í˜„ì¬ëŠ” ìì²´ ê·¸ë˜í”„ ë¹Œë” ì‚¬ìš©)
Bun.worker(); // ë³‘ë ¬ ì²˜ë¦¬
Bun.hash(); // ìºì‹œ í‚¤ ìƒì„±
```

## ì½”ë“œ ì‘ì„± ê°€ì´ë“œ

- TypeScript ì—„ê²© ëª¨ë“œ ì‚¬ìš©
- ì—ëŸ¬ ë©”ì‹œì§€ëŠ” ëª…í™•í•˜ê³  ë„ì›€ì´ ë˜ë„ë¡ ì‘ì„±
- ê° ëª¨ë“ˆë³„ ë…ë¦½ í…ŒìŠ¤íŠ¸ ì‘ì„±
- JSDoc ì£¼ì„ìœ¼ë¡œ API ë¬¸ì„œí™”
- Metroì™€ ìœ ì‚¬í•œ ì—ëŸ¬ í˜•ì‹ ìœ ì§€

## ì„±ëŠ¥ ëª©í‘œ

- ì´ˆê¸° ë¹Œë“œ: Metro ëŒ€ë¹„ 2-3ë°° ë¹ ë¦„
- ì¦ë¶„ ë¹Œë“œ: ìºì‹œ íš¨ìœ¨ë¡œ ì¬ë¹Œë“œ ì‹œê°„ ë‹¨ì¶•
- ë²ˆë“¤ í¬ê¸°: Tree-shakingìœ¼ë¡œ 10-20% ê°ì†Œ
- ë©”ëª¨ë¦¬: ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ì—ì„œë„ ì•ˆì •ì 

## êµ¬í˜„ í˜„í™©

### Phase 1: í•µì‹¬ ë²ˆë“¤ë§

#### âœ… ì™„ë£Œëœ ê¸°ëŠ¥

1. **Config ì‹œìŠ¤í…œ** (Phase 1-1)
   - Config íŒŒì¼ ë¡œë”© (`bungae.config.ts/js/json`, `package.json`)
   - Config ë³‘í•© ë° ê¸°ë³¸ê°’ ì²˜ë¦¬
   - Config ê²€ì¦ ë¡œì§ (íƒ€ì… ë° ê°’ ê²€ì¦)
   - Server config ì¶”ê°€ (port, useGlobalHotkey, forwardClientLogs ë“±)
   - Metro-compatible API (`loadConfig({ config, cwd })`)
   - Metro ìŠ¤íƒ€ì¼ í…ŒìŠ¤íŠ¸ ì½”ë“œ (11ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª¨ë‘ í†µê³¼)

2. **Platform Resolver Plugin** (Phase 1-2)
   - Bun Pluginìœ¼ë¡œ í”Œë«í¼ í™•ì¥ì ì²˜ë¦¬
   - `.ios.js`, `.android.js`, `.native.js` ì§€ì›
   - TypeScript í™•ì¥ì ì§€ì› (`.ios.tsx`, `.android.ts` ë“±)
   - `preferNativePlatform` ì˜µì…˜ ì§€ì›
   - í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ì™„ë£Œ (5ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª¨ë‘ í†µê³¼)

3. **ì½”ë“œ ë³€í™˜ (Transformation)** (Phase 1-3 â†’ Phase 1+)
   - **í˜„ì¬**: Babel + Hermes Parser ê¸°ë°˜ ë³€í™˜ (Metro ë™ì¼)
   - @react-native/babel-preset ì‚¬ìš© (Metroì™€ ë™ì¼í•œ ë³€í™˜)
   - TypeScript/TSX/JSX/Flow â†’ JavaScript ë³€í™˜
   - ì˜ì¡´ì„± ì¶”ì¶œ (require, import, dynamic import)
   - Metro ìŠ¤íƒ€ì¼ í…ŒìŠ¤íŠ¸ ì½”ë“œ í†µê³¼
   - **ë¯¸ì‚¬ìš© ì½”ë“œ ë³´ê´€**: `bun-transformer.ts`, `swc-transformer.ts` (í–¥í›„ ìµœì í™”ìš©)

4. **Serialization** (Phase 1-3)
   - baseJSBundle êµ¬í˜„ (Metro í˜¸í™˜)
   - metro-runtime ë²ˆë“¤ í¬í•¨
   - prelude, polyfills ì§€ì›
   - **d(), **r() í˜•ì‹ ì§€ì›
   - ëª¨ë“ˆ ID ìƒì„± ë° ì •ë ¬
   - Source map URL ì§€ì›
   - Metro ìŠ¤íƒ€ì¼ í…ŒìŠ¤íŠ¸ ì½”ë“œ (15ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª¨ë‘ í†µê³¼)

### Phase 2: ê°œë°œ í™˜ê²½

#### âœ… ì™„ë£Œëœ ê¸°ëŠ¥

1. **ì¦ë¶„ ë¹Œë“œ ì‹œìŠ¤í…œ** (Phase 2-1)
   - `incrementalBuild()` í•¨ìˆ˜ êµ¬í˜„
   - íŒŒì¼ ë³€ê²½ ì‹œ ì˜í–¥ë°›ì€ ëª¨ë“ˆë§Œ ì¬ë¹Œë“œ
   - ì´ì „ ê·¸ë˜í”„ì™€ ìƒˆ ê·¸ë˜í”„ ê°„ ë¸íƒ€ ê³„ì‚° (`calculateDelta()`)
   - ì—­ì˜ì¡´ì„± ê·¸ë˜í”„ë¥¼ í†µí•œ ì˜í–¥ë°›ì€ ëª¨ë“ˆ ì¶”ì  (`getAffectedModules()`)
   - ëª¨ë“ˆ ID ì¼ê´€ì„± ìœ ì§€ (ë™ì¼í•œ `createModuleId` íŒ©í† ë¦¬ ì¬ì‚¬ìš©)
   - í”Œë«í¼ë³„ ë¹Œë“œ ìƒíƒœ ê´€ë¦¬ (ë‹¤ì¤‘ í”Œë«í¼ HMR ì§€ì›)
   - êµ¬í˜„ ìœ„ì¹˜: `graph-bundler.ts`ì˜ `incrementalBuild()` í•¨ìˆ˜

2. **ê°œë°œ ì„œë²„** (Phase 2-2)
   - `serveWithGraph()` í•¨ìˆ˜ êµ¬í˜„
   - Node.js http + Bun ê¸°ë°˜ HTTP ì„œë²„
   - ë²ˆë“¤ ìš”ì²­ ì²˜ë¦¬ (`/index.bundle?platform=ios&dev=true`)
   - WebSocket ì§€ì› (HMRìš©)
   - í”Œë«í¼ë³„ ë²ˆë“¤ ìºì‹±
   - @react-native/dev-middleware í†µí•©
   - @react-native-community/cli-server-api í†µí•©
   - êµ¬í˜„ ìœ„ì¹˜: `graph-bundler/server/index.ts`

3. **HMR (Hot Module Replacement)** (Phase 2-3)
   - **Metro í˜¸í™˜ HMR í”„ë¡œí† ì½œ**: React Nativeì˜ ë‚´ì¥ HMRClientì™€ í˜¸í™˜
   - `buildWithGraph()` í•¨ìˆ˜ê°€ HMR ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•´ graphì™€ `createModuleId` ë°˜í™˜
   - Metro HMR ë©”ì‹œì§€ í˜•ì‹ êµ¬í˜„:
     - `update-start` / `update-done`: ì—…ë°ì´íŠ¸ ìƒëª…ì£¼ê¸°
     - `update`: ì¶”ê°€/ìˆ˜ì •/ì‚­ì œëœ ëª¨ë“ˆ ì •ë³´
     - `error`: ë¹Œë“œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì „ì†¡
   - `createHMRUpdateMessage()`: Metro í˜¸í™˜ HMR ì—…ë°ì´íŠ¸ ë©”ì‹œì§€ ìƒì„±
   - ëª¨ë“ˆ ID ì¼ê´€ì„±: ë¹Œë“œ ê°„ ë™ì¼í•œ `createModuleId` íŒ©í† ë¦¬ ì¬ì‚¬ìš©
   - ì—­ì˜ì¡´ì„± ê·¸ë˜í”„: React Refresh ê²½ê³„ë¥¼ ìœ„í•œ Metroì˜ ìƒí–¥ ìˆœíšŒ íŒ¨í„´ ì§€ì›
   - ë‹¤ì¤‘ í”Œë«í¼ HMR: iOS/Android ê°ê° ë…ë¦½ì ì¸ HMR ì—…ë°ì´íŠ¸
   - êµ¬í˜„ ìœ„ì¹˜: `graph-bundler.ts`ì˜ HMR ê´€ë ¨ í•¨ìˆ˜ë“¤
   - í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ì™„ë£Œ (15ê°œ ì´ìƒì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª¨ë‘ í†µê³¼)

4. **React Refresh (Fast Refresh)** (Phase 2-3)
   - ì™„ì „ ì§€ì› (ì˜ì¡´ì„± ê·¸ë˜í”„ë¥¼ í†µí•´ ìë™ í¬í•¨)
   - Metroì™€ ë™ì¼í•œ ë™ì‘ ë°©ì‹

5. **íŒŒì¼ ê°ì‹œ** (Phase 2-4)
   - `file-watcher.ts` ëª¨ë“ˆ êµ¬í˜„
   - íŒŒì¼ ë³€ê²½ ê°ì§€ ë° HMR íŠ¸ë¦¬ê±°
   - ì›ìì  ì“°ê¸° ì²˜ë¦¬ (VSCode ë“± ì—ë””í„°ì˜ rename ì´ë²¤íŠ¸)
   - JS/TS/JSON ì†ŒìŠ¤ íŒŒì¼ë§Œ ì²˜ë¦¬í•˜ë„ë¡ í•„í„°ë§
   - ë””ë°”ìš´ì‹± ì§€ì› (ê¸°ë³¸ 300ms)
   - êµ¬í˜„ ìœ„ì¹˜: `file-watcher.ts`ì˜ `createFileWatcher()` í•¨ìˆ˜

6. **í„°ë¯¸ë„ ë‹¨ì¶•í‚¤** (Phase 2-5) âœ…
   - Metro í˜¸í™˜ í„°ë¯¸ë„ ë‹¨ì¶•í‚¤ ì§€ì›
   - `r` - Reload (ì•± ë¦¬ë¡œë“œ)
   - `d` - Open Dev Menu (ê°œë°œ ë©”ë‰´ ì—´ê¸°)
   - `i` - Open iOS Simulator
   - `a` - Open Android Emulator
   - `j` - Open Chrome DevTools
   - `c` - Clear cache
   - `useGlobalHotkey` ì„¤ì • ì˜µì…˜ ì§€ì› (ê¸°ë³¸ê°’: true)
   - êµ¬í˜„ ìœ„ì¹˜: `graph-bundler/terminal-actions.ts`

#### HMR (Hot Module Replacement) êµ¬í˜„ ì „ëµ

**ê²°ì •: Metro HMRClient í˜¸í™˜ ë°©ì‹ ì±„íƒ**

React Nativeì˜ ê¸°ë³¸ HMRClient.jsë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³ , Bungae ì„œë²„ê°€ Metro HMR í”„ë¡œí† ì½œì„ êµ¬í˜„í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bungae Dev Server                                      â”‚
â”‚  - íŒŒì¼ ë³€ê²½ ê°ì§€ â†’ ì¬ë²ˆë“¤ë§                              â”‚
â”‚  - Metro HMR í”„ë¡œí† ì½œë¡œ WebSocket ë©”ì‹œì§€ ì „ì†¡             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†• WebSocket (Metro í”„ë¡œí† ì½œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Native App                                       â”‚
â”‚  - HMRClient.js (React Native ê¸°ë³¸ ì œê³µ, ìˆ˜ì • ì—†ìŒ)       â”‚
â”‚  - ì—…ë°ì´íŠ¸ ìˆ˜ì‹  ë° ì ìš©                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Metro HMR í”„ë¡œí† ì½œ ë©”ì‹œì§€ í˜•ì‹:**

```typescript
// ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸
{
  type: 'update',
  body: {
    revisionId: string,
    isInitialUpdate: boolean,
    added: Array<{ module: [number, string], sourceURL: string, sourceMappingURL?: string }>,
    modified: Array<{ module: [number, string], sourceURL: string, sourceMappingURL?: string }>,
    deleted: number[]
  }
}
```

**ì´ ë°©ì‹ì„ ì„ íƒí•œ ì´ìœ :**

| í•­ëª©           | Metro í˜¸í™˜ (ì±„íƒ)      | ìì²´ êµ¬í˜„ (ë¡¤ë¦¬íŒ ë°©ì‹)     |
| -------------- | ---------------------- | --------------------------- |
| ì´ˆê¸° êµ¬í˜„ ë¹„ìš© | ë‚®ìŒ                   | ë†’ìŒ                        |
| ìœ ì§€ë³´ìˆ˜       | RN ì—…ë°ì´íŠ¸ ìë™ ë°˜ì˜  | RN ì—…ë°ì´íŠ¸ë§ˆë‹¤ í˜¸í™˜ì„± í™•ì¸ |
| ë§ˆì´ê·¸ë ˆì´ì…˜   | ì‰¬ì›€                   | ì„¤ì • í•„ìš”                   |
| ì—ì½”ì‹œìŠ¤í…œ     | Flipper, DevTools í˜¸í™˜ | ë³„ë„ ëŒ€ì‘ í•„ìš”              |

1. **Metro í˜¸í™˜ì„± ì›ì¹™ê³¼ ì¼ì¹˜** - ê¸°ì¡´ í”„ë¡œì íŠ¸ ìµœì†Œ ë³€ê²½ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
2. **êµ¬í˜„ ë²”ìœ„ ìµœì†Œí™”** - HMRClient êµ¬í˜„ ë¶ˆí•„ìš”, ì„œë²„ í”„ë¡œí† ì½œë§Œ êµ¬í˜„
3. **React Native ì—…ê·¸ë ˆì´ë“œ ëŒ€ì‘ ìš©ì´** - í”„ë¡œí† ì½œë§Œ ìœ ì§€ë˜ë©´ ë‚´ë¶€ ë³€ê²½ì— ì˜í–¥ ì—†ìŒ
4. **ì—ì½”ì‹œìŠ¤í…œ í˜¸í™˜** - ê¸°ì¡´ ê°œë°œ ë„êµ¬ë“¤ê³¼ í˜¸í™˜

**ì°¸ê³  - ë¡¤ë¦¬íŒì˜ ì ‘ê·¼ ë°©ì‹:**

- ë¡¤ë¦¬íŒì€ ìì²´ HMR í”„ë¡œí† ì½œ(`hmr:update`, `hmr:reload` ë“±)ì„ ì‚¬ìš©
- Rolldown í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ `react-native/Libraries/Utilities/HMRClient.js`ë¥¼ ìì²´ êµ¬í˜„ìœ¼ë¡œ êµì²´
- í”„ë¡œí† ì½œ ììœ ë„ëŠ” ë†’ì§€ë§Œ RN ì—…ë°ì´íŠ¸ë§ˆë‹¤ í˜¸í™˜ì„± ê²€ì¦ í•„ìš”

**í–¥í›„ ê³ ë ¤ì‚¬í•­:**

- Metro í”„ë¡œí† ì½œì˜ í•œê³„ê°€ ëŠê»´ì§€ë©´ ìì²´ HMR í´ë¼ì´ì–¸íŠ¸ ê²€í† 
- ë” íš¨ìœ¨ì ì¸ ì—…ë°ì´íŠ¸ ì „ì†¡ì´ í•„ìš”í•œ ê²½ìš°
- Metroì— ì—†ëŠ” HMR ê¸°ëŠ¥ì´ í•„ìš”í•œ ê²½ìš°

#### React Refresh (Fast Refresh) ì§€ì›

**ì™„ì „ ì§€ì›**: ì˜ì¡´ì„± ê·¸ë˜í”„ë¥¼ í†µí•´ `setUpReactRefresh` ëª¨ë“ˆì´ ìë™ í¬í•¨ë˜ë©°, Metroì™€ ë™ì¼í•˜ê²Œ ì»´í¬ë„ŒíŠ¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©´ì„œ ì½”ë“œ ë³€ê²½ì„ ë°˜ì˜í•©ë‹ˆë‹¤.

#### âœ… Phase 2-3ì—ì„œ êµ¬í˜„ ì™„ë£Œëœ ê¸°ëŠ¥

ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì€ Metro í˜¸í™˜ìœ¼ë¡œ êµ¬í˜„ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤:

1. **inlineSourceMap ì˜µì…˜** âœ…
   - Source mapì„ ë²ˆë“¤ íŒŒì¼ì— ì¸ë¼ì¸ìœ¼ë¡œ í¬í•¨ (base64 ì¸ì½”ë”©)
   - êµ¬í˜„ ìœ„ì¹˜: `serializer/helpers/getAppendScripts.ts`

2. **x_google_ignoreList ìƒì„±** âœ…
   - Chrome DevToolsì—ì„œ íŠ¹ì • ì†ŒìŠ¤ íŒŒì¼ì„ ë””ë²„ê¹…ì—ì„œ ì œì™¸
   - `shouldAddToIgnoreList` ì˜µì…˜ìœ¼ë¡œ ì»¤ìŠ¤í…€ ê°€ëŠ¥
   - ê¸°ë³¸ê°’: `node_modules/` ê²½ë¡œ íŒŒì¼ ì œì™¸
   - êµ¬í˜„ ìœ„ì¹˜: `graph-bundler/build/sourcemap.ts`

#### âœ… Source Map ì •í™•ë„ (ì™„ë£Œ)

- DevTools console.logê°€ ì‚¬ìš©ì ì½”ë“œ ìœ„ì¹˜ (ì˜ˆ: `App.tsx:60`)ë¥¼ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œ
- `x_google_ignoreList`ê°€ ì •ìƒ ì‘ë™í•˜ì—¬ console.js ë“± í´ë¦¬í•„ ê±´ë„ˆëœ€
- vlq íŒ¨í‚¤ì§€ë¡œ Babel ì†ŒìŠ¤ë§µ ì§ì ‘ VLQ ë””ì½”ë”© (Metro ë™ì¼)
- êµ¬í˜„ ìœ„ì¹˜: `graph-bundler/build/sourcemap.ts`

### Phase 3: ìµœì í™” âœ… ì™„ë£Œ

1. **ì˜êµ¬ ìºì‹±** âœ…
   - `PersistentCache` í´ë˜ìŠ¤ êµ¬í˜„ (`cache.ts`)
   - ë””ìŠ¤í¬ ê¸°ë°˜ ìºì‹œ (`.bungae-cache/`)
   - ìºì‹œ ë§Œë£Œ ì²˜ë¦¬ (ê¸°ë³¸ 7ì¼)
   - ì†ŒìŠ¤ íŒŒì¼ ë³€ê²½ ê°ì§€

2. **Minification** âœ…
   - `minify.ts` êµ¬í˜„
   - Bun ë‚´ì¥ minifier, Terser, esbuild, SWC ì§€ì›
   - Metro ëŸ°íƒ€ì„ í•¨ìˆ˜ ì˜ˆì•½ì–´ ì²˜ë¦¬ (`__d`, `__r`, `__DEV__`)

3. **Tree Shaking** âœ…
   - `tree-shaking/` í´ë” êµ¬í˜„
   - `applyTreeShaking()` - ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” export ì œê±°
   - `extractExports()`, `extractImports()` - import/export ë¶„ì„
   - `hasSideEffects()` - side effects ì²´í¬

### Phase 4: ê³ ê¸‰ ê¸°ëŠ¥ (ë¯¸êµ¬í˜„)

#### Metroì— ìˆëŠ” ê¸°ëŠ¥

| ê¸°ëŠ¥                | ì„¤ëª…                                                          | ìš°ì„ ìˆœìœ„ | ë¹„ê³                                                |
| ------------------- | ------------------------------------------------------------- | -------- | -------------------------------------------------- |
| **require.context** | ë™ì  require íŒ¨í„´ (`sync`, `eager`, `lazy`, `lazy-once` ëª¨ë“œ) | ì¤‘ê°„     | Metro ì‹¤í—˜ì  ê¸°ëŠ¥ (`unstable_allowRequireContext`) |
| **RAM Bundle**      | iOS/Android ìµœì í™” ë²ˆë“¤ í˜•ì‹ (Indexed/File)                   | **ë‚®ìŒ** | Hermesê°€ ëŒ€ì²´í•¨. ë ˆê±°ì‹œ í˜¸í™˜ìš©ìœ¼ë¡œë§Œ í•„ìš”          |

#### Metroì— ì—†ê±°ë‚˜ ë¶€ë¶„ì ì¸ ê¸°ëŠ¥

| ê¸°ëŠ¥                | ì„¤ëª…                               | Metro ìƒíƒœ                             | Bungae êµ¬í˜„ ì—¬ë¶€ |
| ------------------- | ---------------------------------- | -------------------------------------- | ---------------- |
| **í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ** | ì‚¬ìš©ì í™•ì¥ (ì»¤ìŠ¤í…€ íŠ¸ëœìŠ¤í¬ë¨¸ ë“±) | Babel í”ŒëŸ¬ê·¸ì¸ë§Œ ì§€ì›                  | ê²€í†  í•„ìš”        |
| **Code Splitting**  | `import()` ë³„ë„ chunk ë¶„ë¦¬         | ë‹¨ì¼ ë²ˆë“¤ë§Œ ì§€ì› (lazy loadingì€ ìˆìŒ) | ê²€í†  í•„ìš”        |
| **ìˆœí™˜ ì°¸ì¡° GC**    | Bacon-Rajan ì•Œê³ ë¦¬ì¦˜               | ì—†ìŒ (ê°ì§€ë§Œ í•¨)                       | êµ¬í˜„ ì•ˆ í•¨       |
| **ë¡¤ë°± ì‹œìŠ¤í…œ**     | ë¹Œë“œ ì—ëŸ¬ ì‹œ ì´ì „ ìƒíƒœ ë³µì›        | ë¶€ë¶„ì  (ê·¸ë˜í”„ ë¹Œë“œ ì¤‘ ë¡¤ë°±ë§Œ)         | ê²€í†  í•„ìš”        |

#### RAM Bundle ì°¸ê³ ì‚¬í•­

RAM Bundleì€ **Hermes ì´ì „ ì‹œëŒ€ì˜ ìµœì í™” ê¸°ë²•**ì…ë‹ˆë‹¤:

- **2019ë…„ ì´ì „**: JSC ì—”ì§„ ì‚¬ìš© â†’ ì „ì²´ ë²ˆë“¤ íŒŒì‹± í•„ìš” â†’ RAM Bundleë¡œ lazy loading
- **2019ë…„ ì´í›„**: Hermes ì—”ì§„ ê¸°ë³¸ â†’ ë°”ì´íŠ¸ì½”ë“œ ì‚¬ì „ ì»´íŒŒì¼ + lazy compilation ë‚´ì¥

React Native ê³µì‹ ë¬¸ì„œì—ì„œë„ "If you are using Hermes, you should not need to use RAM bundles"ë¼ê³  ëª…ì‹œí•©ë‹ˆë‹¤.
í˜„ì¬ ëŒ€ë¶€ë¶„ì˜ RN ì•±ì´ Hermesë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ RAM Bundleì˜ ì‹¤ì œ ìˆ˜ìš”ëŠ” ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.

## Metro í˜¸í™˜ì„± ë° ì œì™¸ëœ ê¸°ëŠ¥

### êµ¬í˜„í•˜ì§€ ì•ŠëŠ” Metro ê¸°ëŠ¥

ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì€ Metroì— ìˆì§€ë§Œ Bungaeì—ì„œëŠ” êµ¬í˜„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:

#### 1. cacheStores (callback íŒ¨í„´)

**Metroì—ì„œì˜ ìš©ë„**:

- ë³€í™˜ ê²°ê³¼ ìºì‹±ì„ ìœ„í•œ ì»¤ìŠ¤í…€ ìºì‹œ ë°±ì—”ë“œ ì§€ì›
- `cacheStores: (MetroCache) => [new CustomStore()]` í˜•íƒœë¡œ `MetroCache`ë¥¼ ì£¼ì…ë°›ì•„ ì»¤ìŠ¤í…€ ìŠ¤í† ì–´ ìƒì„±
- FileStore ì™¸ì—ë„ ë©”ëª¨ë¦¬ ìºì‹œ, Redis ë“± ë‹¤ì–‘í•œ ìºì‹œ ë°±ì—”ë“œ ì§€ì›

**Bungaeì—ì„œ ì œì™¸í•˜ëŠ” ì´ìœ **:

- Bunì€ ìì²´ ìºì‹œ ì‹œìŠ¤í…œì„ ì œê³µí•˜ê±°ë‚˜ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ìºì‹œë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ
- ë¡¤ë¦¬íŒë„ ìì²´ ìºì‹œ ì‹œìŠ¤í…œ(`FileSystemCache`)ì„ ì‚¬ìš©í•˜ë©° Metroì˜ `cacheStores` íŒ¨í„´ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- Bunì˜ ë‚´ì¥ ê¸°ëŠ¥ì„ í™œìš©í•˜ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì 

#### 2. YAML config ì§€ì›

**Metroì—ì„œì˜ ìš©ë„**:

- ë ˆê±°ì‹œ í”„ë¡œì íŠ¸ í˜¸í™˜ì„±: ê³¼ê±°ì— YAML configë¥¼ ì‚¬ìš©í•˜ë˜ í”„ë¡œì íŠ¸ ì§€ì›
- **Deprecated ìƒíƒœ**: ê²½ê³  ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ë©° JavaScript configë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê¶Œì¥

**Bungaeì—ì„œ ì œì™¸í•˜ëŠ” ì´ìœ **:

- ë ˆê±°ì‹œ ì§€ì›ì´ í•„ìš” ì—†ìŒ (ìƒˆë¡œìš´ í”„ë¡œì íŠ¸)
- JavaScript/TypeScript configë§Œ ì§€ì›í•´ë„ ì¶©ë¶„
- ë¡¤ë¦¬íŒë„ YAMLì„ ì§€ì›í•˜ì§€ ì•ŠìŒ
- Metroì—ì„œë„ deprecated ìƒíƒœì´ë¯€ë¡œ ìƒˆ í”„ë¡œì íŠ¸ì—ì„œ êµ¬í˜„í•  í•„ìš” ì—†ìŒ

## ì°¸ê³  ìë£Œ

- Metro ë¬¸ì„œ: `reference/metro/docs/`
- Metro ì†ŒìŠ¤: `reference/metro/packages/`
- **Metro ë²ˆë“¤ ì°¸ì¡°**: `metro/` - Metroë¡œ ìƒì„±ëœ ì‹¤ì œ ë²ˆë“¤ íŒŒì¼ë“¤ (iOS/Android, dev/release)
  - Bungae ë²ˆë“¤ ê²°ê³¼ì™€ Metro ë²ˆë“¤ ê²°ê³¼ë¥¼ ë¹„êµí•˜ê¸° ìœ„í•œ ì°¸ì¡°ìš©
  - ë¹„êµ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ Metro í˜¸í™˜ì„± ê²€ì¦
- Re.Pack ì†ŒìŠ¤: `reference/repack/` - Webpack/Rspack ê¸°ë°˜ React Native ë²ˆë“¤ëŸ¬
- Rollipop ì†ŒìŠ¤: `reference/rollipop/` - Rolldown ê¸°ë°˜ React Native ë²ˆë“¤ëŸ¬
- ìƒì„¸ ê°€ì´ë“œ: `.claude/skills/bungae-bundler/`
